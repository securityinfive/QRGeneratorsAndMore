<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Multicolor Particle Trail</title>
  <style>
    html, body { height: 100%; margin: 0; }
    body { background: #000; overflow: hidden; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    #stage { position: fixed; inset: 0; display: block; width: 100vw; height: 100vh; }
    .hint { position: fixed; left: 16px; bottom: 14px; color: rgba(255,255,255,.7); font-size: 12px; user-select: none; pointer-events: none; }
    .controls { position: fixed; right: 12px; bottom: 12px; display: flex; gap: 8px; }
    .btn { appearance: none; border: 1px solid rgba(255,255,255,.2); background: rgba(255,255,255,.06); color: #fff; padding: 6px 10px; border-radius: 8px; font-size: 12px; cursor: pointer; }
    .btn:active { transform: translateY(1px); }
  </style>
</head>
<body>
  <canvas id="stage"></canvas>
  <div class="hint">Move your mouse or touch to paint a stream of light</div>
  <div class="controls">
    <button id="clear" class="btn" title="Clear the canvas">Clear</button>
    <button id="toggle" class="btn" title="Toggle trails">Toggle Trails</button>
  </div>

  <script>
  (function() {
    const canvas = document.getElementById('stage');
    const ctx = canvas.getContext('2d', { alpha: false });

    let width = 0, height = 0, dpr = Math.max(1, window.devicePixelRatio || 1);
    let raf = 0;

    const mouse = { x: 0, y: 0, active: false };
    const particles = [];
    const maxParticles = 1200;

    let fade = 0.12; // lower value = longer trails

    function resize() {
      width = window.innerWidth; height = window.innerHeight; dpr = Math.max(1, window.devicePixelRatio || 1);
      canvas.width = Math.floor(width * dpr);
      canvas.height = Math.floor(height * dpr);
      canvas.style.width = width + 'px';
      canvas.style.height = height + 'px';
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      ctx.fillStyle = '#000';
      ctx.fillRect(0, 0, width, height);
    }

    function spawn(x, y) {
      const count = 8;
      for (let i = 0; i < count; i++) {
        const angle = Math.random() * Math.PI * 2;
        const speed = 0.5 + Math.random() * 2.2;
        const life = 0.6 + Math.random() * 1.2; // seconds
        const size = 1 + Math.random() * 2.5;
        const hue = (performance.now() * 0.12 + Math.random() * 60) % 360;
        particles.push({ x, y, vx: Math.cos(angle) * speed, vy: Math.sin(angle) * speed, life, ttl: life, size, hue });
      }
      if (particles.length > maxParticles) particles.splice(0, particles.length - maxParticles);
    }

    let last = performance.now();

    function loop(now) {
      const dt = Math.min(0.033, (now - last) / 1000);
      last = now;

      ctx.globalCompositeOperation = 'source-over';
      ctx.fillStyle = `rgba(0,0,0,${fade})`;
      ctx.fillRect(0, 0, width, height);

      if (mouse.active) spawn(mouse.x, mouse.y);

      ctx.globalCompositeOperation = 'lighter';
      for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        p.ttl -= dt;
        if (p.ttl <= 0) { particles.splice(i, 1); continue; }
        p.vy += 0.12 * dt; // gentle downward drift
        p.x += p.vx; p.y += p.vy;
        const alpha = Math.max(0, p.ttl / p.life);
        ctx.beginPath();
        ctx.fillStyle = `hsla(${p.hue}, 80%, 60%, ${alpha})`;
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fill();
      }

      raf = requestAnimationFrame(loop);
    }

    function pointerPosFromEvent(e) {
      let x, y;
      if (e.touches && e.touches.length) {
        x = e.touches[0].clientX; y = e.touches[0].clientY;
      } else {
        x = e.clientX; y = e.clientY;
      }
      mouse.x = x; mouse.y = y; mouse.active = true;
    }

    // Events
    window.addEventListener('resize', resize);
    window.addEventListener('mousemove', pointerPosFromEvent);
    window.addEventListener('mouseleave', () => mouse.active = false);
    window.addEventListener('mouseenter', () => mouse.active = true);

    window.addEventListener('touchstart', (e) => { pointerPosFromEvent(e); e.preventDefault(); }, { passive: false });
    window.addEventListener('touchmove', (e) => { pointerPosFromEvent(e); e.preventDefault(); }, { passive: false });
    window.addEventListener('touchend', () => { mouse.active = false; });

    document.getElementById('clear').addEventListener('click', () => {
      ctx.globalCompositeOperation = 'source-over';
      ctx.fillStyle = '#000';
      ctx.fillRect(0, 0, width, height);
    });

    document.getElementById('toggle').addEventListener('click', () => {
      fade = fade > 0.01 ? 0.01 : 0.12; // toggle long vs short trails
    });

    // Start
    resize();
    last = performance.now();
    raf = requestAnimationFrame(loop);
  })();
  </script>
</body>
</html>
